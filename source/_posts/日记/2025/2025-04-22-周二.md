---
title: 2025-04-22-å‘¨äºŒ
date: 2025-04-21 04:01:33
updated: 2025-04-21 04:01:33
author: Exarlos è‰¾å…‹è¨ç½—æ–¯
email: 452361419@qq.com
description: ä¸–ç•Œä¸Šæ²¡æœ‰ä½çº§çš„æ³•æœ¯,åªæœ‰ä½çº§çš„æ³•å¸ˆ!
keywords: æ—¥è®°
categories:
  - æ—¥è®°
tags:
  - æ—¥è®°
cover:
thumbnail:
password: 747937
message: è¯·è¾“å…¥å¯†ç è®¿é—®
abstract: è¿™ç¯‡æ–‡ç« å—åˆ°äº†ä¿æŠ¤ã€‚
wrong_pass_message: å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•ã€‚
---

<!-- åœ¨æ­¤å¤„æ·»åŠ æ–‡ç« æ‘˜è¦ -->
{% note info %}
**æ–‡ç« æ‘˜è¦**
{% endnote %}

<!-- more -->

# 2025-04-22-å‘¨äºŒ #æ—¥è®°

## ä»Šæ—¥è®¡åˆ’


## å·¥ä½œäº‹é¡¹
// æ˜¨æ—¥æ²¡æœ‰æœªå®Œæˆçš„ä»»åŠ¡

- [ ] 

```dataviewjs
// Get current filename
const currentFilename = dv.current().file.name;

// Extract date from filename (assuming format YYYY-MM-DD-å‘¨X.md)
const dateMatch = currentFilename.match(/^(\d{4}-\d{2}-\d{2})/);

let currentMoment;
if (dateMatch && dateMatch[1]) {
    currentMoment = moment(dateMatch[1], "YYYY-MM-DD");
} else {
    // Fallback or error handling if filename doesn't match
    const fileDay = dv.current().file.day;
    if (fileDay && moment(fileDay.toFormat("YYYY-MM-DD")).isValid()) {
        currentMoment = moment(fileDay.toFormat("YYYY-MM-DD"));
    } else {
        dv.paragraph("âš ï¸ æ— æ³•è·å–æœ‰æ•ˆå½“å‰æ—¥æœŸï¼Œæ— æ³•è®¡ç®—æ˜¨æ—¥äº‹é¡¹ã€‚");
        // Stop execution if no valid date is found
        return;
    }
}

// Ensure currentMoment is valid before proceeding
if (!currentMoment || !currentMoment.isValid()) {
    dv.paragraph("âš ï¸ æ— æ•ˆçš„å½“å‰æ—¥æœŸï¼Œæ— æ³•è®¡ç®—æ˜¨æ—¥äº‹é¡¹ã€‚");
    return;
}

// Calculate yesterday's date - Clone the moment object to avoid modifying the original
const yesterdayMoment = currentMoment.clone().subtract(1, 'days');

// Format yesterday's date string (e.g., "2025-04-21")
const yesterdayDateStr = yesterdayMoment.format("YYYY-MM-DD");

// Map day numbers to Chinese day names (0 = Sunday, 1 = Monday, etc.)
const dayMap = ["å‘¨æ—¥", "å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­"];
const yesterdayDayName = dayMap[yesterdayMoment.day()]; // Get Chinese day name using day() which returns 0-6

// Construct the expected filename for yesterday's diary
const yesterdayFileName = `${yesterdayDateStr}-${yesterdayDayName}.md`;

// Construct the folder path for yesterday's diary based on the year
const yesterdayYear = yesterdayMoment.format("YYYY");
const yesterdayFolderPath = `source/_posts/æ—¥è®°/${yesterdayYear}`;

// è°ƒè¯•ä¿¡æ¯
dv.paragraph(`ğŸ” æ­£åœ¨æŸ¥æ‰¾æ˜¨æ—¥æ—¥è®°: ${yesterdayDateStr}-${yesterdayDayName}`);

// ä½¿ç”¨æ›´çµæ´»çš„æŸ¥è¯¢æ–¹å¼
let allDiaryPages = dv.pages()
    .where(p => p.file.path.includes('/æ—¥è®°/') &&
           p.file.name.startsWith(yesterdayDateStr));

// æ˜¾ç¤ºæ‰¾åˆ°çš„æ–‡ä»¶æ•°é‡
dv.paragraph(`ğŸ“‹ æ‰¾åˆ° ${allDiaryPages.length} ä¸ªå¯èƒ½çš„æ–‡ä»¶`);

// æŸ¥æ‰¾æ˜¨å¤©çš„æ—¥è®°æ–‡ä»¶
let yesterdayFile = null;

if (allDiaryPages.length > 0) {
    // æ˜¾ç¤ºæ‰¾åˆ°çš„æ‰€æœ‰æ–‡ä»¶
    for (let i = 0; i < allDiaryPages.length; i++) {
        dv.paragraph(`- æ–‡ä»¶ ${i+1}: ${allDiaryPages[i].file.name} (è·¯å¾„: ${allDiaryPages[i].file.path})`);
    }

    // å°è¯•ç²¾ç¡®åŒ¹é…
    const exactMatch = allDiaryPages.find(p => p.file.name === yesterdayFileName.replace('.md', ''));
    if (exactMatch) {
        yesterdayFile = exactMatch.file;
        dv.paragraph(`âœ… æ‰¾åˆ°ç²¾ç¡®åŒ¹é…: ${yesterdayFile.name}`);
    } else {
        // å¦‚æœæ²¡æœ‰ç²¾ç¡®åŒ¹é…ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªä»¥æ˜¨å¤©æ—¥æœŸå¼€å¤´çš„æ–‡ä»¶
        yesterdayFile = allDiaryPages[0].file;
        dv.paragraph(`âš ï¸ æœªæ‰¾åˆ°ç²¾ç¡®åŒ¹é…ï¼Œä½¿ç”¨æœ€æ¥è¿‘çš„æ–‡ä»¶: ${yesterdayFile.name}`);
    }
}

if (yesterdayFile) {
    try {
        // è¯»å–æ–‡ä»¶å†…å®¹
        const content = await dv.io.load(yesterdayFile.path);
        const lines = content.split('\n');
        let inTaskSection = false;
        const unfinishedTasks = [];

        // æŸ¥æ‰¾æœªå®Œæˆçš„ä»»åŠ¡
        for (const line of lines) {
            if (line.trim().startsWith('## å·¥ä½œäº‹é¡¹')) {
                inTaskSection = true;
                continue;
            }
            // å¦‚æœé‡åˆ°ä¸‹ä¸€ä¸ªäºŒçº§æ ‡é¢˜æˆ–æ–‡ä»¶ç»“æŸæ ‡è®°ï¼Œåœæ­¢è¯»å–
            if (inTaskSection && (line.trim().startsWith('## ') || line.trim().startsWith('---') || line.trim().startsWith('```dataview'))) {
                inTaskSection = false;
                break;
            }
            if (inTaskSection && line.trim().startsWith('- [ ]')) {
                // åªæå–ä»»åŠ¡æ–‡æœ¬ï¼Œä¸æ·»åŠ é“¾æ¥
                unfinishedTasks.push(line.trim());
            }
        }

        // æ˜¾ç¤ºæœªå®Œæˆçš„ä»»åŠ¡
        if (unfinishedTasks.length > 0) {
            // æ·»åŠ æ ‡é¢˜å’Œæ˜¨æ—¥æ—¥è®°çš„é“¾æ¥
            dv.header(4, `æ˜¨æ—¥æœªå®Œæˆäº‹é¡¹ (æ¥è‡ª [[${yesterdayFile.path}|${yesterdayDateStr}]])`);

            // æ˜¾ç¤ºæ¯ä¸ªæœªå®Œæˆçš„ä»»åŠ¡
            for(let task of unfinishedTasks) {
                dv.paragraph(task);
            }
        } else {
            dv.paragraph("âœ… æ˜¨æ—¥äº‹é¡¹å·²å…¨éƒ¨å®Œæˆã€‚");
        }
    } catch (error) {
        dv.paragraph(`âš ï¸ è¯»å–æ˜¨æ—¥æ—¥è®°æ–‡ä»¶æ—¶å‡ºé”™: ${error.message}`);
    }
} else {
    // æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
    dv.paragraph(`â„¹ï¸ æœªæ‰¾åˆ°æ˜¨æ—¥ (${yesterdayDateStr}-${yesterdayDayName}) çš„æ—¥è®°æ–‡ä»¶ã€‚`);
    dv.paragraph(`é¢„æœŸè·¯å¾„: ${yesterdayFolderPath}/${yesterdayFileName}`);

    // æ·»åŠ æ‰‹åŠ¨å¡«å†™æ˜¨æ—¥æœªå®Œæˆäº‹é¡¹çš„éƒ¨åˆ†
    dv.header(4, "æ‰‹åŠ¨æ·»åŠ æ˜¨æ—¥æœªå®Œæˆäº‹é¡¹");
    dv.paragraph("- [ ] åœ¨æ­¤å¤„æ‰‹åŠ¨æ·»åŠ æ˜¨æ—¥æœªå®Œæˆçš„ä»»åŠ¡");
}
```


<!-- æœˆè®°å’Œå‘¨è®°æŸ¥è¯¢ -->
```dataview
table file.name as "å‘¨è®°ä¸æœˆè®°", file.cday as "åˆ›å»ºæ—¶é—´"
from "å‘¨è®°" or "æœˆè®°"
where year = this.file.cday.year
where month = this.file.cday.month
sort ascending
```




---
> æœ¬æ–‡ç”± Exarlos åˆ›ä½œï¼Œé‡‡ç”¨ [çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®](http://creativecommons.org/licenses/by-nc-sa/4.0/) è¿›è¡Œè®¸å¯ã€‚

<!-- Obsidian å…ƒæ•°æ® (ä¸ä¼šå½±å“ Hexo è§£æ) -->
<!--
åˆ›å»ºæ—¶é—´: 2025-04-21-æ˜ŸæœŸä¸€ 04:01
year: 2025
month: 04
week: 17
day: 21
-->

